@echo off
chcp 65001 >nul
color 0A
echo ???????????????????????????????????????????????????????????????
echo     ?? GIT COMMIT SCRIPT - COFFEE SHOP XML PROJECT
echo ???????????????????????????????????????????????????????????????
echo.

REM Ki?m tra Git
git --version >nul 2>&1
if errorlevel 1 (
    echo [? L?I] Git ch?a ???c cài ??t!
    echo.
    echo T?i Git t?i: https://git-scm.com/download/win
    pause
    exit /b 1
)

echo [?] Git ?ã cài ??t
echo.

REM Hi?n th? tr?ng thái hi?n t?i
echo ???????????????????????????????????????????????????????????????
echo [1/6] TR?NG THÁI HI?N T?I:
echo ???????????????????????????????????????????????????????????????
git status
echo.

REM Xác nh?n ti?p t?c
echo ???????????????????????????????????????????????????????????????
set /p continue="Ti?p t?c commit? (Y/N): "
if /i not "%continue%"=="Y" (
    echo ?ã h?y.
    pause
    exit /b 0
)

echo.
echo ???????????????????????????????????????????????????????????????
echo [2/6] ?ANG STAGE SOURCE CODE...
echo ???????????????????????????????????????????????????????????????

REM Stage các file source code
git add QUANLYCOFFEESHOP/*.cs 2>nul
git add QUANLYCOFFEESHOP/DAL/*.cs 2>nul
git add QUANLYCOFFEESHOP/DTO/*.cs 2>nul
git add QUANLYCOFFEESHOP/GUI/*.cs 2>nul
git add QUANLYCOFFEESHOP/GUI/*.Designer.cs 2>nul
git add QUANLYCOFFEESHOP/GUI/*.resx 2>nul
git add QUANLYCOFFEESHOP/Utils/*.cs 2>nul
git add QUANLYCOFFEESHOP/Properties/*.cs 2>nul
git add QUANLYCOFFEESHOP/Properties/*.resx 2>nul
git add QUANLYCOFFEESHOP/*.csproj 2>nul
git add QUANLYCOFFEESHOP/*.config 2>nul
git add *.sln 2>nul
git add *.txt 2>nul
git add .gitignore 2>nul
git add README.md 2>nul

echo [?] ?ã stage các file source code
echo.

REM Hi?n th? file ?ã stage
echo ???????????????????????????????????????????????????????????????
echo [3/6] FILE ?Ã STAGE:
echo ???????????????????????????????????????????????????????????????
git status --short
echo.

REM Nh?p commit message
echo ???????????????????????????????????????????????????????????????
echo [4/6] COMMIT MESSAGE:
echo ???????????????????????????????????????????????????????????????
echo.
echo G?i ý:
echo   - Fix: S?a l?i mã hóa ??n trùng, FK constraint, ComboBox
echo   - Add: Thêm tính n?ng t? ??ng kh?i t?o d? li?u
echo   - Update: C?p nh?t h? th?ng XML thu?n
echo   - Refactor: T?i ?u code và c?u trúc
echo.
set /p commit_msg="Nh?p message (Enter = m?c ??nh): "
if "%commit_msg%"=="" set commit_msg=Fix: Kh?c ph?c các l?i h? th?ng - mã HD trùng, FK constraint, ComboBox không c?p nh?t

echo.
echo ???????????????????????????????????????????????????????????????
echo [5/6] ?ANG COMMIT...
echo ???????????????????????????????????????????????????????????????
git commit -m "%commit_msg%"

if errorlevel 1 (
    echo.
    echo [? L?I] Commit th?t b?i!
    pause
    exit /b 1
)

echo [?] Commit thành công!
echo.

REM H?i push
echo ???????????????????????????????????????????????????????????????
echo [6/6] PUSH LÊN GITHUB?
echo ???????????????????????????????????????????????????????????????
set /p push="Push lên GitHub ngay? (Y/N): "
if /i "%push%"=="Y" (
    echo.
    echo ?ang push...
    git push origin main
    
    if errorlevel 1 (
        echo.
        echo [?? C?NH BÁO] Push th?t b?i!
        echo.
        echo Có th? do:
        echo   - Ch?a pull code m?i nh?t
        echo   - Không có quy?n push
        echo   - Không có k?t n?i internet
        echo.
        echo Th? ch?y:
        echo   git pull origin main
        echo   git push origin main
    ) else (
        echo [?] Push thành công!
    )
) else (
    echo.
    echo ?? push sau, ch?y:
    echo   git push origin main
)

echo.
echo ???????????????????????????????????????????????????????????????
echo     ? HOÀN T?T!
echo ???????????????????????????????????????????????????????????????
echo.
echo Ki?m tra trên GitHub:
echo   https://github.com/khoavo1501/BTL_QUANLYCOFFEESHOPXML
echo.
pause
